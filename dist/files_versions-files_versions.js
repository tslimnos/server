/*! For license information please see files_versions-files_versions.js.LICENSE.txt */
(()=>{var e,i={22420:(e,i,l)=>{"use strict";l(29088),l(47673);var s=l(94702),o=l.n(s),r=l(97834),a=l.n(r),c=l(19755),d=l(64492);!function(){if(!OCA.Files.DetailTabView)return;const e=OCA.Files.DetailTabView.extend({id:"versionsTabView",className:"tab versionsTabView",_template:null,$versionsContainer:null,events:{"click .revertVersion":"_onClickRevertVersion"},initialize(){OCA.Files.DetailTabView.prototype.initialize.apply(this,arguments),this.collection=new OCA.Versions.VersionCollection,this.collection.on("request",this._onRequest,this),this.collection.on("sync",this._onEndRequest,this),this.collection.on("update",this._onUpdate,this),this.collection.on("error",this._onError,this),this.collection.on("add",this._onAddModel,this)},getLabel:()=>t("files_versions","Versions"),getIcon:()=>"icon-history",nextPage(){this._loading||this.collection.getFileInfo()&&this.collection.getFileInfo().isDirectory()||this.collection.fetch()},_onClickRevertVersion(e){const n=this;let i=c(e.target);const l=this.collection.getFileInfo();i.is("li")||(i=i.closest("li")),e.preventDefault();const s=i.attr("data-revision"),o=this.collection.get(s);o.revert({success(){n.$versionsContainer.empty(),n.collection.setFileInfo(l),n.collection.reset([],{silent:!0}),n.collection.fetch(),n.$el.find(".versions").removeClass("hidden"),l.trigger("busy",l,!1),l.set({size:o.get("size"),mtime:1e3*o.get("timestamp"),etag:o.get("id")+o.get("timestamp")})},error(){l.trigger("busy",l,!1),n.$el.find(".versions").removeClass("hidden"),n._toggleLoading(!1),OC.Notification.show(t("files_version","Failed to revert {file} to revision {timestamp}.",{file:o.getFullPath(),timestamp:OC.Util.formatDate(1e3*o.get("timestamp"))}),{type:"error"})}}),this._toggleLoading(!0),l.trigger("busy",l,!0)},_toggleLoading(e){this._loading=e,this.$el.find(".loading").toggleClass("hidden",!e)},_onRequest(){this._toggleLoading(!0)},_onEndRequest(){this._toggleLoading(!1),this.$el.find(".empty").toggleClass("hidden",!!this.collection.length)},_onAddModel(e){const n=c(this.itemTemplate(this._formatItem(e)));this.$versionsContainer.append(n),n.find(".has-tooltip").tooltip()},template:e=>a()(e),itemTemplate:e=>o()(e),setFileInfo(e){e?(this.render(),this.collection.setFileInfo(e),this.collection.reset([],{silent:!0}),this.nextPage()):(this.render(),this.collection.reset())},_formatItem(e){const i=1e3*e.get("timestamp"),l=e.has("size")?e.get("size"):0,s=OC.MimeType.getIconUrl(e.get("mimetype")),o=new Image;return o.onload=function(){c("li[data-revision="+e.get("id")+"] .preview").attr("src",e.getPreviewUrl())},o.src=e.getPreviewUrl(),d.extend({versionId:e.get("id"),formattedTimestamp:OC.Util.formatDate(i),relativeTimestamp:OC.Util.relativeModifiedDate(i),millisecondsTimestamp:i,humanReadableSize:OC.Util.humanFileSize(l,!0),altSize:n("files","%n byte","%n bytes",l),hasDetails:e.has("size"),downloadUrl:e.getDownloadUrl(),downloadIconUrl:OC.imagePath("core","actions/download"),downloadName:e.get("name"),revertIconUrl:OC.imagePath("core","actions/history"),previewUrl:s,revertLabel:t("files_versions","Restore"),canRevert:0!=(this.collection.getFileInfo().get("permissions")&OC.PERMISSION_UPDATE)},e.attributes)},render(){this.$el.html(this.template({emptyResultLabel:t("files_versions","No other versions available")})),this.$el.find(".has-tooltip").tooltip(),this.$versionsContainer=this.$el.find("ul.versions"),this.delegateEvents()},canDisplay:e=>!!e&&!e.isDirectory()});OCA.Versions=OCA.Versions||{},OCA.Versions.VersionsTabView=e}(),l(29020);var u=l(93379),p=l.n(u),h=l(42028);p()(h.Z,{insert:"head",singleton:!1}),h.Z.locals,window.OCA.Versions=OCA.Versions},29020:()=>{OCA.Versions=OCA.Versions||{},OCA.Versions.Util={attach(e){"trashbin"!==e.id&&"files.public"!==e.id&&e.registerTabView(new OCA.Versions.VersionsTabView("versionsTabView",{order:-10}))}},OC.Plugins.register("OCA.Files.FileList",OCA.Versions.Util)},47673:(e,n,t)=>{var i=t(64492);!function(){const e=OC.Backbone.Collection.extend({model:OCA.Versions.VersionModel,sync:OC.Backbone.davSync,_fileInfo:null,_currentUser:null,_client:null,setFileInfo(e){this._fileInfo=e},getFileInfo(){return this._fileInfo},setCurrentUser(e){this._currentUser=e},getCurrentUser(){return this._currentUser||OC.getCurrentUser().uid},setClient(e){this._client=e},getClient(){return this._client||new OC.Files.Client({host:OC.getHost(),root:OC.linkToRemoteBase("dav")+"/versions/"+this.getCurrentUser(),useHTTPS:"https"===OC.getProtocol()})},url(){return OC.linkToRemoteBase("dav")+"/versions/"+this.getCurrentUser()+"/versions/"+this._fileInfo.get("id")},parse(e){const n=this._fileInfo.getFullPath(),t=this._fileInfo.get("id"),l=this._fileInfo.get("name"),s=this.getCurrentUser(),o=this.getClient();return i.map(e,(function(e){return e.fullPath=n,e.fileId=t,e.name=l,e.timestamp=parseInt(moment(new Date(e.timestamp)).format("X"),10),e.id=OC.basename(e.href),e.size=parseInt(e.size,10),e.user=s,e.client=o,e}))}});OCA.Versions=OCA.Versions||{},OCA.Versions.VersionCollection=e}()},29088:(e,n,t)=>{var i=t(64492);!function(){const e=OC.Backbone.Model.extend({sync:OC.Backbone.davSync,davProperties:{size:"{DAV:}getcontentlength",mimetype:"{DAV:}getcontenttype",timestamp:"{DAV:}getlastmodified"},revert(e){e=e?i.clone(e):{};const n=this;return this.get("client").move("/versions/"+this.get("fileId")+"/"+this.get("id"),"/restore/target",!0).done((function(){e.success&&e.success.call(e.context,n,{},e),n.trigger("revert",n,e)})).fail((function(){e.error&&e.error.call(e.context,n,{},e),n.trigger("error",n,{},e)}))},getFullPath(){return this.get("fullPath")},getPreviewUrl(){const e=OC.generateUrl("/apps/files_versions/preview"),n={file:this.get("fullPath"),version:this.get("id")};return e+"?"+OC.buildQueryString(n)},getDownloadUrl(){return OC.linkToRemoteBase("dav")+"/versions/"+this.get("user")+"/versions/"+this.get("fileId")+"/"+this.get("id")}});OCA.Versions=OCA.Versions||{},OCA.Versions.VersionModel=e}()},42028:(e,n,t)=>{"use strict";t.d(n,{Z:()=>r});var i=t(94015),l=t.n(i),s=t(23645),o=t.n(s)()(l());o.push([e.id,".versionsTabView .clear-float {\n\tclear: both;\n}\n\n.versionsTabView li {\n\twidth: 100%;\n\tcursor: default;\n\theight: 56px;\n\tfloat: left;\n\tborder-bottom: 1px solid rgba(100,100,100,.1);\n}\n.versionsTabView li:last-child {\n\tborder-bottom: none;\n}\n\n.versionsTabView a,\n.versionsTabView div > span {\n\tvertical-align: middle;\n\topacity: .5;\n}\n\n.versionsTabView li a{\n\tpadding: 15px 10px 11px;\n}\n\n.versionsTabView a:hover,\n.versionsTabView a:focus {\n\topacity: 1;\n}\n\n.versionsTabView .preview-container {\n\tdisplay: inline-block;\n  vertical-align: top;\n}\n\n.versionsTabView img {\n\tcursor: pointer;\n\tpadding-right: 4px;\n}\n\n.versionsTabView img.preview {\n\tcursor: default;\n}\n\n.versionsTabView .version-container {\n\tdisplay: inline-block;\n}\n\n.versionsTabView .versiondate {\n\tmin-width: 100px;\n\tvertical-align: super;\n}\n\n.versionsTabView .version-details {\n\ttext-align: left;\n}\n\n.versionsTabView .version-details > span {\n\tpadding: 0 10px;\n}\n\n.versionsTabView .revertVersion {\n\tcursor: pointer;\n\tfloat: right;\n\tmargin-right: -10px;\n}\n","",{version:3,sources:["webpack://./apps/files_versions/src/css/versions.css"],names:[],mappings:"AAAA;CACC,WAAW;AACZ;;AAEA;CACC,WAAW;CACX,eAAe;CACf,YAAY;CACZ,WAAW;CACX,6CAA6C;AAC9C;AACA;CACC,mBAAmB;AACpB;;AAEA;;CAEC,sBAAsB;CACtB,WAAW;AACZ;;AAEA;CACC,uBAAuB;AACxB;;AAEA;;CAEC,UAAU;AACX;;AAEA;CACC,qBAAqB;EACpB,mBAAmB;AACrB;;AAEA;CACC,eAAe;CACf,kBAAkB;AACnB;;AAEA;CACC,eAAe;AAChB;;AAEA;CACC,qBAAqB;AACtB;;AAEA;CACC,gBAAgB;CAChB,qBAAqB;AACtB;;AAEA;CACC,gBAAgB;AACjB;;AAEA;CACC,eAAe;AAChB;;AAEA;CACC,eAAe;CACf,YAAY;CACZ,mBAAmB;AACpB",sourcesContent:[".versionsTabView .clear-float {\n\tclear: both;\n}\n\n.versionsTabView li {\n\twidth: 100%;\n\tcursor: default;\n\theight: 56px;\n\tfloat: left;\n\tborder-bottom: 1px solid rgba(100,100,100,.1);\n}\n.versionsTabView li:last-child {\n\tborder-bottom: none;\n}\n\n.versionsTabView a,\n.versionsTabView div > span {\n\tvertical-align: middle;\n\topacity: .5;\n}\n\n.versionsTabView li a{\n\tpadding: 15px 10px 11px;\n}\n\n.versionsTabView a:hover,\n.versionsTabView a:focus {\n\topacity: 1;\n}\n\n.versionsTabView .preview-container {\n\tdisplay: inline-block;\n  vertical-align: top;\n}\n\n.versionsTabView img {\n\tcursor: pointer;\n\tpadding-right: 4px;\n}\n\n.versionsTabView img.preview {\n\tcursor: default;\n}\n\n.versionsTabView .version-container {\n\tdisplay: inline-block;\n}\n\n.versionsTabView .versiondate {\n\tmin-width: 100px;\n\tvertical-align: super;\n}\n\n.versionsTabView .version-details {\n\ttext-align: left;\n}\n\n.versionsTabView .version-details > span {\n\tpadding: 0 10px;\n}\n\n.versionsTabView .revertVersion {\n\tcursor: pointer;\n\tfloat: right;\n\tmargin-right: -10px;\n}\n"],sourceRoot:""}]);const r=o},94702:(e,n,t)=>{var i=t(40202);e.exports=(i.default||i).template({1:function(e,n,t,i,l){var s,o=null!=n?n:e.nullContext||{},r=e.hooks.helperMissing,a="function",c=e.escapeExpression,d=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t\t\t<div class="version-details">\n\t\t\t\t\t<span class="size has-tooltip" title="'+c(typeof(s=null!=(s=d(t,"altSize")||(null!=n?d(n,"altSize"):n))?s:r)===a?s.call(o,{name:"altSize",hash:{},data:l,loc:{start:{line:14,column:43},end:{line:14,column:54}}}):s)+'">'+c(typeof(s=null!=(s=d(t,"humanReadableSize")||(null!=n?d(n,"humanReadableSize"):n))?s:r)===a?s.call(o,{name:"humanReadableSize",hash:{},data:l,loc:{start:{line:14,column:56},end:{line:14,column:77}}}):s)+"</span>\n\t\t\t\t</div>\n"},3:function(e,n,t,i,l){var s,o=null!=n?n:e.nullContext||{},r=e.hooks.helperMissing,a="function",c=e.escapeExpression,d=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t\t<a href="#" class="revertVersion" title="'+c(typeof(s=null!=(s=d(t,"revertLabel")||(null!=n?d(n,"revertLabel"):n))?s:r)===a?s.call(o,{name:"revertLabel",hash:{},data:l,loc:{start:{line:19,column:44},end:{line:19,column:59}}}):s)+'"><img src="'+c(typeof(s=null!=(s=d(t,"revertIconUrl")||(null!=n?d(n,"revertIconUrl"):n))?s:r)===a?s.call(o,{name:"revertIconUrl",hash:{},data:l,loc:{start:{line:19,column:71},end:{line:19,column:88}}}):s)+'" /></a>\n'},compiler:[8,">= 4.3.0"],main:function(e,n,t,i,l){var s,o,r,a=null!=n?n:e.nullContext||{},c=e.hooks.helperMissing,d="function",u=e.escapeExpression,p=e.hooks.blockHelperMissing,h=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]},m='<li data-revision="'+u(typeof(o=null!=(o=h(t,"id")||(null!=n?h(n,"id"):n))?o:c)===d?o.call(a,{name:"id",hash:{},data:l,loc:{start:{line:1,column:19},end:{line:1,column:25}}}):o)+'">\n\t<div>\n\t\t<div class="preview-container">\n\t\t\t<img class="preview" src="'+u(typeof(o=null!=(o=h(t,"previewUrl")||(null!=n?h(n,"previewUrl"):n))?o:c)===d?o.call(a,{name:"previewUrl",hash:{},data:l,loc:{start:{line:4,column:29},end:{line:4,column:43}}}):o)+'" width="44" height="44"/>\n\t\t</div>\n\t\t<div class="version-container">\n\t\t\t<div>\n\t\t\t\t<a href="'+u(typeof(o=null!=(o=h(t,"downloadUrl")||(null!=n?h(n,"downloadUrl"):n))?o:c)===d?o.call(a,{name:"downloadUrl",hash:{},data:l,loc:{start:{line:8,column:13},end:{line:8,column:28}}}):o)+'" class="downloadVersion" download="'+u(typeof(o=null!=(o=h(t,"downloadName")||(null!=n?h(n,"downloadName"):n))?o:c)===d?o.call(a,{name:"downloadName",hash:{},data:l,loc:{start:{line:8,column:64},end:{line:8,column:80}}}):o)+'"><img src="'+u(typeof(o=null!=(o=h(t,"downloadIconUrl")||(null!=n?h(n,"downloadIconUrl"):n))?o:c)===d?o.call(a,{name:"downloadIconUrl",hash:{},data:l,loc:{start:{line:8,column:92},end:{line:8,column:111}}}):o)+'" />\n\t\t\t\t\t<span class="versiondate has-tooltip live-relative-timestamp" data-timestamp="'+u(typeof(o=null!=(o=h(t,"millisecondsTimestamp")||(null!=n?h(n,"millisecondsTimestamp"):n))?o:c)===d?o.call(a,{name:"millisecondsTimestamp",hash:{},data:l,loc:{start:{line:9,column:83},end:{line:9,column:108}}}):o)+'" title="'+u(typeof(o=null!=(o=h(t,"formattedTimestamp")||(null!=n?h(n,"formattedTimestamp"):n))?o:c)===d?o.call(a,{name:"formattedTimestamp",hash:{},data:l,loc:{start:{line:9,column:117},end:{line:9,column:139}}}):o)+'">'+u(typeof(o=null!=(o=h(t,"relativeTimestamp")||(null!=n?h(n,"relativeTimestamp"):n))?o:c)===d?o.call(a,{name:"relativeTimestamp",hash:{},data:l,loc:{start:{line:9,column:141},end:{line:9,column:162}}}):o)+"</span>\n\t\t\t\t</a>\n\t\t\t</div>\n";return o=null!=(o=h(t,"hasDetails")||(null!=n?h(n,"hasDetails"):n))?o:c,r={name:"hasDetails",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l,loc:{start:{line:12,column:3},end:{line:16,column:18}}},s=typeof o===d?o.call(a,r):o,h(t,"hasDetails")||(s=p.call(n,s,r)),null!=s&&(m+=s),m+="\t\t</div>\n",o=null!=(o=h(t,"canRevert")||(null!=n?h(n,"canRevert"):n))?o:c,r={name:"canRevert",hash:{},fn:e.program(3,l,0),inverse:e.noop,data:l,loc:{start:{line:18,column:2},end:{line:20,column:16}}},s=typeof o===d?o.call(a,r):o,h(t,"canRevert")||(s=p.call(n,s,r)),null!=s&&(m+=s),m+"\t</div>\n</li>\n"},useData:!0})},97834:(e,n,t)=>{var i=t(40202);e.exports=(i.default||i).template({compiler:[8,">= 4.3.0"],main:function(e,n,t,i,l){var s,o=null!=n?n:e.nullContext||{},r=e.hooks.helperMissing,a="function",c=e.escapeExpression,d=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<ul class="versions"></ul>\n<div class="clear-float"></div>\n<div class="empty hidden">\n\t<div class="emptycontent">\n\t\t<div class="icon-history"></div>\n\t\t<p>'+c(typeof(s=null!=(s=d(t,"emptyResultLabel")||(null!=n?d(n,"emptyResultLabel"):n))?s:r)===a?s.call(o,{name:"emptyResultLabel",hash:{},data:l,loc:{start:{line:6,column:5},end:{line:6,column:25}}}):s)+'</p>\n\t</div>\n</div>\n<input type="button" class="showMoreVersions hidden" value="'+c(typeof(s=null!=(s=d(t,"moreVersionsLabel")||(null!=n?d(n,"moreVersionsLabel"):n))?s:r)===a?s.call(o,{name:"moreVersionsLabel",hash:{},data:l,loc:{start:{line:9,column:60},end:{line:9,column:81}}}):s)+'" name="show-more-versions" id="show-more-versions" />\n<div class="loading hidden" style="height: 50px"></div>\n'},useData:!0})}},l={};function s(e){var n=l[e];if(void 0!==n)return n.exports;var t=l[e]={id:e,loaded:!1,exports:{}};return i[e].call(t.exports,t,t.exports,s),t.loaded=!0,t.exports}s.m=i,s.amdD=function(){throw new Error("define cannot be used indirect")},s.amdO={},e=[],s.O=(n,t,i,l)=>{if(!t){var o=1/0;for(d=0;d<e.length;d++){t=e[d][0],i=e[d][1],l=e[d][2];for(var r=!0,a=0;a<t.length;a++)(!1&l||o>=l)&&Object.keys(s.O).every((e=>s.O[e](t[a])))?t.splice(a--,1):(r=!1,l<o&&(o=l));if(r){e.splice(d--,1);var c=i();void 0!==c&&(n=c)}}return n}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[t,i,l]},s.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return s.d(n,{a:n}),n},s.d=(e,n)=>{for(var t in n)s.o(n,t)&&!s.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),s.j=358,(()=>{var e={358:0};s.O.j=n=>0===e[n];var n=(n,t)=>{var i,l,o=t[0],r=t[1],a=t[2],c=0;if(o.some((n=>0!==e[n]))){for(i in r)s.o(r,i)&&(s.m[i]=r[i]);if(a)var d=a(s)}for(n&&n(t);c<o.length;c++)l=o[c],s.o(e,l)&&e[l]&&e[l][0](),e[o[c]]=0;return s.O(d)},t=self.webpackChunknextcloud=self.webpackChunknextcloud||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})();var o=s.O(void 0,[874],(()=>s(22420)));o=s.O(o)})();
//# sourceMappingURL=files_versions-files_versions.js.map?v=8d7c2e02ccd54d42232c